"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6491],{3905:(e,r,n)=>{n.d(r,{Zo:()=>u,kt:()=>s});var t=n(7294);function l(e,r,n){return r in e?Object.defineProperty(e,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[r]=n,e}function a(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function i(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?a(Object(n),!0).forEach((function(r){l(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function o(e,r){if(null==e)return{};var n,t,l=function(e,r){if(null==e)return{};var n,t,l={},a=Object.keys(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||(l[n]=e[n]);return l}(e,r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)n=a[t],r.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}var c=t.createContext({}),p=function(e){var r=t.useContext(c),n=r;return e&&(n="function"==typeof e?e(r):i(i({},r),e)),n},u=function(e){var r=p(e.components);return t.createElement(c.Provider,{value:r},e.children)},k={inlineCode:"code",wrapper:function(e){var r=e.children;return t.createElement(t.Fragment,{},r)}},d=t.forwardRef((function(e,r){var n=e.components,l=e.mdxType,a=e.originalType,c=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=p(n),s=l,m=d["".concat(c,".").concat(s)]||d[s]||k[s]||a;return n?t.createElement(m,i(i({ref:r},u),{},{components:n})):t.createElement(m,i({ref:r},u))}));function s(e,r){var n=arguments,l=r&&r.mdxType;if("string"==typeof e||l){var a=n.length,i=new Array(a);i[0]=d;var o={};for(var c in r)hasOwnProperty.call(r,c)&&(o[c]=r[c]);o.originalType=e,o.mdxType="string"==typeof e?e:l,i[1]=o;for(var p=2;p<a;p++)i[p]=n[p];return t.createElement.apply(null,i)}return t.createElement.apply(null,n)}d.displayName="MDXCreateElement"},5e3:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>k,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var t=n(7462),l=(n(7294),n(3905));const a={sidebar_label:"Build Linux Kernel for ROCK 5B",sidebar_position:6},i="\u5728ROCK 5B \u6784\u5efaKernel",o={unversionedId:"rock5/rock5b/advanced/build_kernel",id:"rock5/rock5b/advanced/build_kernel",title:"\u5728ROCK 5B \u6784\u5efaKernel",description:"- \u51c6\u5907 ROCK5B",source:"@site/docs/rock5/rock5b/advanced/build_kernel.md",sourceDirName:"rock5/rock5b/advanced",slug:"/rock5/rock5b/advanced/build_kernel",permalink:"/rock5/rock5b/advanced/build_kernel",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rock5/rock5b/advanced/build_kernel.md",tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_label:"Build Linux Kernel for ROCK 5B",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"HDMI Input User Guide",permalink:"/rock5/rock5b/advanced/hdmi-in"},next:{title:"Build U-boot for ROCK 5B",permalink:"/rock5/rock5b/advanced/build_uboot"}},c={},p=[{value:"\u5b89\u88c5\u5fc5\u8981\u5305",id:"\u5b89\u88c5\u5fc5\u8981\u5305",level:2},{value:"\u83b7\u53d6\u6e90\u4ee3\u7801",id:"\u83b7\u53d6\u6e90\u4ee3\u7801",level:2},{value:"\u4ecb\u7ecd",id:"\u4ecb\u7ecd",level:3},{value:"\u6784\u5efaKernel",id:"\u6784\u5efakernel",level:2},{value:"\u4fee\u6539\u5185\u6838\u914d\u7f6e\u6587\u4ef6",id:"\u4fee\u6539\u5185\u6838\u914d\u7f6e\u6587\u4ef6",level:2},{value:"\u6784\u5efaKernel\u5305",id:"\u6784\u5efakernel\u5305",level:2},{value:"\u5b89\u88c5kernel\u5305",id:"\u5b89\u88c5kernel\u5305",level:2},{value:"FAQs",id:"faqs",level:2}],u={toc:p};function k(e){let{components:r,...n}=e;return(0,l.kt)("wrapper",(0,t.Z)({},u,n,{components:r,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"\u5728rock-5b-\u6784\u5efakernel"},"\u5728ROCK 5B \u6784\u5efaKernel"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u51c6\u5907 ROCK5B")),(0,l.kt)("h2",{id:"\u5b89\u88c5\u5fc5\u8981\u5305"},"\u5b89\u88c5\u5fc5\u8981\u5305"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ sudo apt-get update\n$ sudo apt-get install -y git  device-tree-compiler libncurses5 libncurses5-dev build-essential libssl-dev mtools bc python dosfstools bison flex rsync u-boot-tools make\n")),(0,l.kt)("h2",{id:"\u83b7\u53d6\u6e90\u4ee3\u7801"},"\u83b7\u53d6\u6e90\u4ee3\u7801"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ mkdir ~/rk3588-sdk && cd ~/rk3588-sdk\n$ git clone -b linux-5.10-gen-rkr3.4 https://github.com/radxa/kernel.git\n$ git clone -b master https://github.com/radxa/rkbin.git\n$ git clone -b debian https://github.com/radxa/build.git\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f60\u5c06\u83b7\u5f97\u5982\u4e0b\u5185\u5bb9")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"build  kernel  rkbin\n")),(0,l.kt)("h3",{id:"\u4ecb\u7ecd"},"\u4ecb\u7ecd"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"build: \u7528\u4e8e\u6784\u5efau-boot\u3001\u5185\u6838\u548crootfs \u7684\u4e00\u4e9b\u811a\u672c\u6587\u4ef6\u548c\u914d\u7f6e\u6587\u4ef6\u3002"),(0,l.kt)("li",{parentName:"ul"},"rkbin: \u9884\u6784\u5efa\u7684 Rockchip \u4e8c\u8fdb\u5236\u6587\u4ef6\uff0c\u5305\u62ec\u7b2c\u4e00\u9636\u6bb5loader\u548c ATF\uff08Arm Trustzone \u56fa\u4ef6\uff09\u3002"),(0,l.kt)("li",{parentName:"ul"},"u-boot: u-boot \u4f5c\u4e3a\u7b2c\u4e8c\u9636\u6bb5bootloader")),(0,l.kt)("h2",{id:"\u6784\u5efakernel"},"\u6784\u5efaKernel"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u9ed8\u8ba4\u9009\u62e9\u5185\u6838\u5206\u652f\uff1a linux-5.10-gen-rkr3.4."),(0,l.kt)("li",{parentName:"ul"},"\u6784\u5efaKernel\u9ed8\u8ba4 rockchip_linux_defconfig.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ cd ~/rk3588-sdk\n$ ./build/mk-kernel.sh rk3588-rock-5b    # For ROCK 5B\n")),(0,l.kt)("h2",{id:"\u4fee\u6539\u5185\u6838\u914d\u7f6e\u6587\u4ef6"},"\u4fee\u6539\u5185\u6838\u914d\u7f6e\u6587\u4ef6"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u53ef\u4ee5\u9009\u62e9\u4fee\u6539\u5185\u6838\u914d\u7f6e\u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ cd ~/rk3588-sdk\n$ cd kernel\n$ make rockchip_linux_defconfig\n$ make menuconfig\n$ make savedefconfig\n$ cp defconfig arch/arm64/configs/rockchip_linux_defconfig\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u7528\u65b0\u7684\u914d\u7f6e\u6587\u4ef6\u6784\u5efaKernel")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ cd ~/rk3588-sdk\n$ ./build/mk-kernel.sh rk3588-rock-5b    # For ROCK 5B\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f60\u5c06\u5f97\u5230\u5185\u6838image \u548c dtb \u6587\u4ef6")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ ls out/kernel/\nImage  rk3588-rock-5b.dtb\n")),(0,l.kt)("h2",{id:"\u6784\u5efakernel\u5305"},"\u6784\u5efaKernel\u5305"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5185\u6838\u5305kernel package\u6784\u5efa\u53ef\u4ee5\u5c06\u5185\u6838\u3001\u8bbe\u5907\u6811\u3001\u6a21\u5757\u548c\u56fa\u4ef6\u6253\u5305\u6210 Debian \u5305\uff0c\u8fd9\u4f7f\u5f97\u5728 ROCK 5B \u4e0a\u5b89\u88c5\u66f4\u5bb9\u6613\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ ./build/pack-kernel.sh -d rockchip_linux_defconfig -r 99 # [-d rockchip_linux_defconfig: kernel defconfig] [99: release number]\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u751f\u6210\u7684\u5305\u5c06\u88ab\u590d\u5236\u5230 out/packages \u76ee\u5f55\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ ls out/packages/\nlinux-5.10.110-99-rockchip-g9fd61a9a9912_5.10.110-99-rockchip_arm64.changes\nlinux-headers-5.10.110-99-rockchip-g9fd61a9a9912_5.10.110-99-rockchip_arm64.deb\nlinux-image-5.10.110-99-rockchip-g9fd61a9a9912-dbg_5.10.110-99-rockchip_arm64.deb\nlinux-image-5.10.110-99-rockchip-g9fd61a9a9912_5.10.110-99-rockchip_arm64.deb\nlinux-libc-dev_5.10.110-99-rockchip_arm64.deb\n")),(0,l.kt)("h2",{id:"\u5b89\u88c5kernel\u5305"},"\u5b89\u88c5kernel\u5305"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u5f53\u60a8\u60f3\u8981\u5c06\u6307\u5b9a\u7684\u5185\u6838\u5305\u5b89\u88c5\u5230\u60a8\u7684\u64cd\u4f5c\u7cfb\u7edf\u65f6\uff0c\u8bf7\u5c1d\u8bd5\u4ee5\u4e0b\u6b65\u9aa4\u3002")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ sudo dpkg -i out/packages/linux-headers-5.10.110-99-rockchip-g9fd61a9a9912_5.10.110-99-rockchip_arm64.deb\n$ sudo dpkg -i out/packages/linux-image-5.10.110-99-rockchip-g9fd61a9a9912_5.10.110-99-rockchip_arm64.deb\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u4f60\u4f1a\u53d1\u73b0\u5728/boot\u76ee\u5f55\u4e0b\u751f\u6210\u4e86\u4e00\u4e9b\u6587\u4ef6\u3002"),(0,l.kt)("li",{parentName:"ul"},"\u68c0\u67e5",(0,l.kt)("strong",{parentName:"li"},"\u914d\u7f6e\u6587\u4ef6/boot/extlinux/extlinux.conf\u3002"))),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"timeout 10\nmenu title select kernel\n\n# Set default kernel version\ndefault kernel-5.10.110-99-rockchip-g9fd61a9a9912\n\nlabel kernel-5.10.110-99-rockchip-g9fd61a9a9912\n    kernel /vmlinuz-5.10.110-99-rockchip-g9fd61a9a9912\n    initrd /initrd.img-5.10.110-99-rockchip-g9fd61a9a9912\n    devicetreedir /dtbs/5.10.110-99-rockchip-g9fd61a9a9912\n    append   root=UUID=a6820e76-421d-4275-bdae-0ad612df361b earlycon=uart8250,mmio32,0xfeb50000 console=ttyFIQ0 console=tty1 consoleblank=0 loglevel=7 panic=10 rootwait rw init=/sbin/init rootfstype=ext4 cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory swapaccount=1 irqchip.gicv3_pseudo_nmi=0 switolb=1 coherent_pool=2M\n\nlabel kernel-5.10.110-34-rockchip-gca15bbe36e6c\n    kernel /vmlinuz-5.10.110-34-rockchip-gca15bbe36e6c\n    initrd /initrd.img-5.10.110-34-rockchip-gca15bbe36e6c\n    devicetreedir /dtbs/5.10.110-34-rockchip-gca15bbe36e6c\n    append   root=UUID=a6820e76-421d-4275-bdae-0ad612df361b earlycon=uart8250,mmio32,0xfeb50000 console=ttyFIQ0 console=tty1 consoleblank=0 loglevel=7 panic=10 rootwait rw init=/sbin/init rootfstype=ext4 cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory swapaccount=1 irqchip.gicv3_pseudo_nmi=0 switolb=1 coherent_pool=2M\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u91cd\u542f\u8bbe\u5907\u4e4b\u540e\uff0c\u68c0\u67e5\u5185\u6838\u7248\u672c")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ uname -a\nLinux rock-5b 5.10.110-99-rockchip-g9fd61a9a9912 #rockchip SMP Sun Jan 29 17:51:26 UTC 2023 aarch64 GNU/Linux\n")),(0,l.kt)("h2",{id:"faqs"},"FAQs"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6784\u5efa\u5185\u6838\u5305\u65f6\uff0c\u51fa\u73b0\u201cinternal compiler error: Segmentation fault\u201d\u9519\u8bef\uff0c\u5982\u4e0b\uff1a")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"  CC [M]  drivers/net/wireless/rockchip_wlan/rtl8852bu/phl/test/verify/phl_test_verify.o\nduring GIMPLE pass: local-fnsummary\ndrivers/net/wireless/rockchip_wlan/rtl8852be/phl/test/mp/phl_test_mp_reg.c: In function 'phl_mp_reg_read_macreg':\ndrivers/net/wireless/rockchip_wlan/rtl8852be/phl/test/mp/phl_test_mp_reg.c:320:1: internal compiler error: Segmentation fault\n  320 | }\n      | ^\nPlease submit a full bug report,\nwith preprocessed source if appropriate.\nSee <file:///usr/share/doc/gcc-10/README.Bugs> for instructions.\nThe bug is not reproducible, so it is likely a hardware or OS problem.\nmake[9]: *** [scripts/Makefile.build:274: drivers/net/wireless/rockchip_wlan/rtl8852be/phl/test/mp/phl_test_mp_reg.o] Error 1\nmake[9]: *** Waiting for unfinished jobs....\n  CC [M]  drivers/net/wireless/rockchip_wlan/rtl8852bu/phl/test/verify/dbcc/phl_test_dbcc.o\n")),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"\u6211\u4eec\u53ef\u4ee5\u5ffd\u7565\u5b83\u3002 \u8bf7\u5728repository build\u6784\u5efa\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u8865\u4e01\u3002 \u5e76\u901a\u8fc7\u547d\u4ee4\u518d\u6b21\u6784\u5efa\u5185\u6838")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"./build/pack-kernel.sh -d rockchip_linux_defconfig -r 99\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'diff --git a/pack-kernel.sh b/pack-kernel.sh\nindex 5aa2e89ca..2ec116808 100755\n--- a/pack-kernel.sh\n+++ b/pack-kernel.sh\n@@ -34,7 +34,7 @@ if [ "X$(uname -m)" == "Xaarch64" ]; then\n fi\n \n echo -e "\\e[31m Start to pack kernel. \\e[0m"\n-cd ${KERNEL_DIR} && make distclean && make -f $ROCKCHIP_BSP_DIR/build/kernel-package.mk kernel-package\n+cd ${KERNEL_DIR} && make -f $ROCKCHIP_BSP_DIR/build/kernel-package.mk kernel-package\n \n mv $ROCKCHIP_BSP_DIR/linux-*${RELEASE_NUMBER}-rockchip*.deb $PACKAGES_DIR\n mv $ROCKCHIP_BSP_DIR/linux-*${RELEASE_NUMBER}-rockchip*.changes $PACKAGES_DIR\n')))}k.isMDXComponent=!0}}]);